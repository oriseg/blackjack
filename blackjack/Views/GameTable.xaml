<ContentPage
    x:Class="blackjack.Views.GameTable"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:conv="clr-namespace:blackjack.Converters"
    xmlns:m="clr-namespace:blackjack.Models"
    xmlns:vm="clr-namespace:blackjack.ViewModels"
    x:DataType="vm:GameTableVM"
    BackgroundColor="LightGreen">

    <!--  Converters  -->
    <ContentPage.Resources>
        <ResourceDictionary>
            <conv:PlayerToRectConverter x:Key="PlayerToRectConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <!--  ROOT LAYOUT  -->
    <AbsoluteLayout x:Name="RootLayout">
        <Frame
            Padding="8"
            AbsoluteLayout.LayoutBounds="1,0,67,50"
            AbsoluteLayout.LayoutFlags="PositionProportional"
            BackgroundColor="Green"
            CornerRadius="10"
            HasShadow="True">
            <!--  The ID itself  -->
            <Label
                FontSize="14"
                Text="{Binding Id}"
                TextColor="White"
                VerticalOptions="Center" />
        </Frame>
        <!--  WaitingMessage  -->
        <Label
            FontSize="20"
            HorizontalOptions="Center"
            Text="{Binding WaitingMessage}"
            VerticalOptions="Center" />
        <!--  TABLE  -->
        <Frame
            x:Name="Table"
            AbsoluteLayout.LayoutBounds="0.5,0.45,400,160"
            AbsoluteLayout.LayoutFlags="PositionProportional"
            BackgroundColor="DarkGreen"
            CornerRadius="100" />

        <!--  DEALER  -->
        <Frame
            x:Name="Dealer"
            AbsoluteLayout.LayoutBounds="0.5,0.25,80,80"
            AbsoluteLayout.LayoutFlags="PositionProportional"
            BackgroundColor="Maroon"
            CornerRadius="40"
            HeightRequest="85"
            WidthRequest="85">

            <Label
                HorizontalOptions="Center"
                Text="Dealer"
                TextColor="White"
                VerticalOptions="Center" />
        </Frame>

        <!--  PLAYERS AROUND TABLE  -->
        <AbsoluteLayout x:Name="PlayersLayout" BindableLayout.ItemsSource="{Binding Players}">

            <BindableLayout.ItemTemplate>
                <DataTemplate x:DataType="m:Player">

                    <Border
                        AbsoluteLayout.LayoutBounds="{Binding ., Converter={StaticResource PlayerToRectConverter}}"
                        AbsoluteLayout.LayoutFlags="None"
                        BackgroundColor="Black"
                        Stroke="Transparent"
                        StrokeShape="RoundRectangle 30"
                        StrokeThickness="2">

                        <Border.Style>
                            <Style TargetType="Border">
                                <Setter Property="Stroke" Value="Transparent" />
                                <Setter Property="StrokeThickness" Value="2" />
                                <Setter Property="BackgroundColor" Value="Black" />

                                <Style.Triggers>
                                    <!--  Highlight active player  -->
                                    <DataTrigger
                                        Binding="{Binding IsCurrentTurn}"
                                        TargetType="Border"
                                        Value="True">
                                        <Setter Property="BackgroundColor" Value="Gold" />
                                        <Setter Property="Stroke" Value="Red" />
                                        <Setter Property="StrokeThickness" Value="4" />
                                        <Setter Property="Shadow">
                                            <Setter.Value>
                                                <Shadow
                                                    Brush="Red"
                                                    Opacity="0.7"
                                                    Radius="20"
                                                    Offset="0,0" />
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>

                        <Label
                            HorizontalOptions="Center"
                            Text="{Binding UserName}"
                            TextColor="Black"
                            VerticalOptions="Center" />

                    </Border>

                </DataTemplate>
            </BindableLayout.ItemTemplate>

        </AbsoluteLayout>

        <!--  NEXT TURN BUTTON  -->
        <Button
            AbsoluteLayout.LayoutBounds="0.5,0.95,140,45"
            AbsoluteLayout.LayoutFlags="PositionProportional"
            BackgroundColor="DarkBlue"
            Command="{Binding NextTurnCommand}"
            CornerRadius="15"
            IsEnabled="{Binding IsMyTurn}"
            Text="Next Turn"
            TextColor="White" />

    </AbsoluteLayout>
</ContentPage>